<Page x:Class="AionGate.Admin.Pages.ChannelsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.modernwpf.com/2019"
      Title="æ¸ é“åˆ†å‘ç®¡ç†">

    <Page.Resources>
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltHighBrush}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- é¡µé¢æ ‡é¢˜ -->
        <TextBlock Grid.Row="0" Text="æ¸ é“åˆ†å‘ç®¡ç†" FontSize="28" FontWeight="Bold" Margin="0,0,0,20"/>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <UniformGrid Grid.Row="1" Rows="1" Columns="4" Margin="0,0,0,20">
            <!-- æ€»æ¸ é“æ•° -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="ðŸ“Š" FontSize="32" Margin="0,0,0,8"/>
                    <TextBlock Text="æ€»æ¸ é“æ•°" FontSize="14" Opacity="0.7" Margin="0,0,0,4"/>
                    <TextBlock x:Name="TxtTotalChannels" Text="0" FontSize="32" FontWeight="Bold"/>
                </StackPanel>
            </Border>

            <!-- ç´¯è®¡ç”¨æˆ· -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="ðŸ‘¥" FontSize="32" Margin="0,0,0,8"/>
                    <TextBlock Text="ç´¯è®¡ç”¨æˆ·" FontSize="14" Opacity="0.7" Margin="0,0,0,4"/>
                    <TextBlock x:Name="TxtTotalUsers" Text="0" FontSize="32" FontWeight="Bold"/>
                </StackPanel>
            </Border>

            <!-- ç´¯è®¡å……å€¼ -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="ðŸ’°" FontSize="32" Margin="0,0,0,8"/>
                    <TextBlock Text="ç´¯è®¡å……å€¼" FontSize="14" Opacity="0.7" Margin="0,0,0,4"/>
                    <TextBlock x:Name="TxtTotalRevenue" Text="Â¥0.00" FontSize="32" FontWeight="Bold" Foreground="#4CAF50"/>
                </StackPanel>
            </Border>

            <!-- å¾…ç»“ç®—åˆ†æˆ -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="ðŸ’³" FontSize="32" Margin="0,0,0,8"/>
                    <TextBlock Text="å¾…ç»“ç®—åˆ†æˆ" FontSize="14" Opacity="0.7" Margin="0,0,0,4"/>
                    <TextBlock x:Name="TxtUnpaidCommission" Text="Â¥0.00" FontSize="32" FontWeight="Bold" Foreground="#FF9800"/>
                </StackPanel>
            </Border>
        </UniformGrid>

        <!-- ä¸»å†…å®¹åŒº -->
        <ui:TabControl Grid.Row="2">
            <!-- æ¸ é“åˆ—è¡¨ -->
            <ui:TabItem Header="æ¸ é“åˆ—è¡¨">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- å·¥å…·æ  -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- æœç´¢æ¡† -->
                            <ui:AutoSuggestBox Grid.Column="0" PlaceholderText="æœç´¢æ¸ é“åç§°æˆ–ä»£ç ..." Width="300" HorizontalAlignment="Left"/>

                            <!-- æ“ä½œæŒ‰é’® -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                <Button Content="âž• æ·»åŠ æ¸ é“" Style="{StaticResource AccentButtonStyle}" Click="AddChannel_Click"/>
                                <Button Content="ðŸ”„ åˆ·æ–°" Click="RefreshChannels_Click"/>
                                <Button Content="ðŸ“Š ç»Ÿè®¡æŠ¥è¡¨" Click="ViewChannelReport_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- æ¸ é“åˆ—è¡¨ -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <DataGrid x:Name="ChannelsDataGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  SelectionMode="Single"
                                  GridLinesVisibility="Horizontal"
                                  AlternatingRowBackground="#F5F5F5">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="æ¸ é“ä»£ç " Binding="{Binding ChannelCode}" Width="120"/>
                                <DataGridTextColumn Header="æ¸ é“åç§°" Binding="{Binding ChannelName}" Width="150"/>
                                <DataGridTextColumn Header="è”ç³»äºº" Binding="{Binding ContactPerson}" Width="100"/>
                                <DataGridTextColumn Header="è”ç³»QQ" Binding="{Binding ContactQQ}" Width="100"/>
                                <DataGridTextColumn Header="åˆ†æˆæ¯”ä¾‹" Binding="{Binding CommissionRate, StringFormat=P2}" Width="80"/>
                                <DataGridTextColumn Header="ç´¯è®¡ç”¨æˆ·" Binding="{Binding TotalUsers}" Width="80"/>
                                <DataGridTextColumn Header="æ´»è·ƒç”¨æˆ·" Binding="{Binding ActiveUsers}" Width="80"/>
                                <DataGridTextColumn Header="ç´¯è®¡å……å€¼" Binding="{Binding TotalRevenue, StringFormat=C2}" Width="120"/>
                                <DataGridTextColumn Header="ç´¯è®¡åˆ†æˆ" Binding="{Binding TotalCommission, StringFormat=C2}" Width="120"/>
                                <DataGridTextColumn Header="å¾…ç»“ç®—" Binding="{Binding UnpaidCommission, StringFormat=C2}" Width="120"/>
                                <DataGridTextColumn Header="çŠ¶æ€" Binding="{Binding StatusText}" Width="80"/>
                                <DataGridTemplateColumn Header="æ“ä½œ" Width="200">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <Button Content="ðŸ“" ToolTip="ç¼–è¾‘" Width="32" Click="EditChannel_Click"/>
                                                <Button Content="ðŸ“Š" ToolTip="ç»Ÿè®¡" Width="32" Click="ViewChannelStats_Click"/>
                                                <Button Content="ðŸ’°" ToolTip="ç»“ç®—" Width="32" Click="SettleChannel_Click"/>
                                                <Button Content="ðŸ”—" ToolTip="æŽ¨å¹¿é“¾æŽ¥" Width="32" Click="ManageLinks_Click"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </ui:TabItem>

            <!-- ç»“ç®—ç®¡ç† -->
            <ui:TabItem Header="ç»“ç®—ç®¡ç†">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- å·¥å…·æ  -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <ComboBox x:Name="CmbSettlementStatus" Width="150">
                                <ComboBoxItem Content="å…¨éƒ¨çŠ¶æ€" IsSelected="True"/>
                                <ComboBoxItem Content="å¾…å®¡æ ¸"/>
                                <ComboBoxItem Content="å·²å®¡æ ¸"/>
                                <ComboBoxItem Content="å·²æ”¯ä»˜"/>
                            </ComboBox>
                            <DatePicker x:Name="DateStartPicker" Width="150"/>
                            <TextBlock Text="è‡³" VerticalAlignment="Center"/>
                            <DatePicker x:Name="DateEndPicker" Width="150"/>
                            <Button Content="ðŸ” æŸ¥è¯¢" Style="{StaticResource AccentButtonStyle}" Click="SearchSettlements_Click"/>
                            <Button Content="ðŸ’° æ‰¹é‡ç»“ç®—" Click="BatchSettle_Click"/>
                        </StackPanel>
                    </Border>

                    <!-- ç»“ç®—åˆ—è¡¨ -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <DataGrid x:Name="SettlementsDataGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  SelectionMode="Extended"
                                  GridLinesVisibility="Horizontal"
                                  AlternatingRowBackground="#F5F5F5">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="é€‰æ‹©" Width="50"/>
                                <DataGridTextColumn Header="ç»“ç®—å•å·" Binding="{Binding SettlementNo}" Width="150"/>
                                <DataGridTextColumn Header="æ¸ é“åç§°" Binding="{Binding ChannelName}" Width="150"/>
                                <DataGridTextColumn Header="ç»“ç®—å‘¨æœŸ" Binding="{Binding SettlementPeriod}" Width="100"/>
                                <DataGridTextColumn Header="ç»“ç®—é‡‘é¢" Binding="{Binding TotalAmount, StringFormat=C2}" Width="120"/>
                                <DataGridTextColumn Header="å……å€¼ç¬”æ•°" Binding="{Binding RechargeCount}" Width="80"/>
                                <DataGridTextColumn Header="å……å€¼ç”¨æˆ·" Binding="{Binding UserCount}" Width="80"/>
                                <DataGridTextColumn Header="çŠ¶æ€" Binding="{Binding StatusText}" Width="80"/>
                                <DataGridTextColumn Header="åˆ›å»ºæ—¶é—´" Binding="{Binding CreatedAt, StringFormat=yyyy-MM-dd}" Width="120"/>
                                <DataGridTemplateColumn Header="æ“ä½œ" Width="180">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <Button Content="âœ…" ToolTip="å®¡æ ¸" Width="32" Click="AuditSettlement_Click"/>
                                                <Button Content="ðŸ’³" ToolTip="æ”¯ä»˜" Width="32" Click="PaySettlement_Click"/>
                                                <Button Content="ðŸ“„" ToolTip="æŸ¥çœ‹è¯¦æƒ…" Width="32" Click="ViewSettlementDetail_Click"/>
                                                <Button Content="ðŸ“¥" ToolTip="å¯¼å‡º" Width="32" Click="ExportSettlement_Click"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </ui:TabItem>

            <!-- æŽ¨å¹¿é“¾æŽ¥ -->
            <ui:TabItem Header="æŽ¨å¹¿é“¾æŽ¥">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- å·¥å…·æ  -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <ComboBox x:Name="CmbLinkChannel" Width="200" DisplayMemberPath="ChannelName"/>
                            <Button Content="âž• ç”ŸæˆæŽ¨å¹¿é“¾æŽ¥" Style="{StaticResource AccentButtonStyle}" Click="GenerateLink_Click"/>
                            <Button Content="ðŸ”„ åˆ·æ–°" Click="RefreshLinks_Click"/>
                        </StackPanel>
                    </Border>

                    <!-- æŽ¨å¹¿é“¾æŽ¥åˆ—è¡¨ -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <DataGrid x:Name="LinksDataGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  GridLinesVisibility="Horizontal"
                                  AlternatingRowBackground="#F5F5F5">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="æ¸ é“åç§°" Binding="{Binding ChannelName}" Width="150"/>
                                <DataGridTextColumn Header="é“¾æŽ¥ä»£ç " Binding="{Binding LinkCode}" Width="120"/>
                                <DataGridTextColumn Header="æŽ¨å¹¿é“¾æŽ¥" Binding="{Binding LinkUrl}" Width="300"/>
                                <DataGridTextColumn Header="ç‚¹å‡»æ¬¡æ•°" Binding="{Binding ClickCount}" Width="80"/>
                                <DataGridTextColumn Header="ä¸‹è½½æ¬¡æ•°" Binding="{Binding DownloadCount}" Width="80"/>
                                <DataGridTextColumn Header="æ³¨å†Œæ¬¡æ•°" Binding="{Binding RegisterCount}" Width="80"/>
                                <DataGridTextColumn Header="è½¬åŒ–çŽ‡" Binding="{Binding ConversionRate, StringFormat=P2}" Width="80"/>
                                <DataGridTextColumn Header="åˆ›å»ºæ—¶é—´" Binding="{Binding CreatedAt, StringFormat=yyyy-MM-dd}" Width="120"/>
                                <DataGridTemplateColumn Header="æ“ä½œ" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <Button Content="ðŸ“‹" ToolTip="å¤åˆ¶é“¾æŽ¥" Width="32" Click="CopyLink_Click"/>
                                                <Button Content="ðŸ”—" ToolTip="ç”ŸæˆäºŒç»´ç " Width="32" Click="GenerateQRCode_Click"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </ui:TabItem>

            <!-- æ•°æ®ç»Ÿè®¡ -->
            <ui:TabItem Header="æ•°æ®ç»Ÿè®¡">
                <ScrollViewer>
                    <StackPanel Margin="16">
                        <!-- æ—¥æœŸé€‰æ‹© -->
                        <Border Style="{StaticResource CardStyle}">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <TextBlock Text="ç»Ÿè®¡å‘¨æœŸï¼š" VerticalAlignment="Center" FontWeight="Bold"/>
                                <RadioButton Content="ä»Šå¤©" GroupName="Period" IsChecked="True"/>
                                <RadioButton Content="æœ¬å‘¨" GroupName="Period"/>
                                <RadioButton Content="æœ¬æœˆ" GroupName="Period"/>
                                <RadioButton Content="è‡ªå®šä¹‰" GroupName="Period"/>
                                <DatePicker Width="150"/>
                                <TextBlock Text="è‡³" VerticalAlignment="Center"/>
                                <DatePicker Width="150"/>
                                <Button Content="ðŸ” æŸ¥è¯¢" Style="{StaticResource AccentButtonStyle}"/>
                            </StackPanel>
                        </Border>

                        <!-- æ¸ é“æŽ’è¡Œæ¦œ -->
                        <Border Style="{StaticResource CardStyle}">
                            <StackPanel>
                                <TextBlock Text="æ¸ é“æŽ’è¡Œæ¦œ" FontSize="20" FontWeight="Bold" Margin="0,0,0,16"/>
                                <DataGrid x:Name="ChannelRankingDataGrid"
                                          AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          IsReadOnly="True"
                                          GridLinesVisibility="Horizontal"
                                          MaxHeight="400">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="æŽ’å" Binding="{Binding Rank}" Width="60"/>
                                        <DataGridTextColumn Header="æ¸ é“åç§°" Binding="{Binding ChannelName}" Width="150"/>
                                        <DataGridTextColumn Header="æ–°å¢žç”¨æˆ·" Binding="{Binding NewUsers}" Width="100"/>
                                        <DataGridTextColumn Header="æ´»è·ƒç”¨æˆ·" Binding="{Binding ActiveUsers}" Width="100"/>
                                        <DataGridTextColumn Header="å……å€¼é‡‘é¢" Binding="{Binding RechargeAmount, StringFormat=C2}" Width="120"/>
                                        <DataGridTextColumn Header="åˆ†æˆé‡‘é¢" Binding="{Binding CommissionAmount, StringFormat=C2}" Width="120"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </ui:TabItem>
        </ui:TabControl>
    </Grid>
</Page>
