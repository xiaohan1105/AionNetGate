<Page x:Class="AionGate.Admin.Pages.PlayersPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.modernwpf.com/2019"
      Title="çŽ©å®¶ç®¡ç†">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- æœç´¢æ  -->
        <Border Grid.Row="0" Style="{StaticResource CardStyle}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                    <TextBox x:Name="SearchBox" PlaceholderText="æœç´¢çŽ©å®¶ï¼ˆè´¦å·/è§’è‰²å/IPï¼‰"
                             Width="300" VerticalAlignment="Center"/>
                    <ComboBox x:Name="StatusFilter" Width="120" SelectedIndex="0">
                        <ComboBoxItem Content="å…¨éƒ¨çŠ¶æ€"/>
                        <ComboBoxItem Content="åœ¨çº¿"/>
                        <ComboBoxItem Content="ç¦»çº¿"/>
                        <ComboBoxItem Content="å·²å°ç¦"/>
                    </ComboBox>
                    <Button Content="ðŸ” æœç´¢" Style="{StaticResource AccentButtonStyle}"
                            Click="Search_Click"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button Content="ðŸŽ æ‰¹é‡å‘é€é“å…·" Click="BatchSendItems_Click"/>
                    <Button Content="ðŸ’° æ‰¹é‡å‘é€ç‚¹åˆ¸" Click="BatchSendPoints_Click"/>
                    <Button Content="ðŸ“§ æ‰¹é‡å‘é€é‚®ä»¶" Click="BatchSendMail_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- åœ¨çº¿çŽ©å®¶å®žæ—¶é¢æ¿ -->
        <Border Grid.Row="1" Style="{StaticResource CardStyle}">
            <StackPanel>
                <Grid Margin="0,0,0,12">
                    <TextBlock Text="ðŸŸ¢ å½“å‰åœ¨çº¿çŽ©å®¶" FontSize="16" FontWeight="Bold"/>
                    <TextBlock x:Name="OnlineCountLabel" Text="0 äººåœ¨çº¿" HorizontalAlignment="Right"
                               FontSize="14" Foreground="#4CAF50"/>
                </Grid>

                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled"
                              Height="80">
                    <ItemsControl x:Name="OnlinePlayersPanel">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource SystemControlBackgroundAccentBrush}"
                                        CornerRadius="16" Padding="12,6" Margin="4"
                                        ToolTip="{Binding Tooltip}">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="ðŸŸ¢" FontSize="10" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Name}" Foreground="White"
                                                   FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Level}" Foreground="White"
                                                   Opacity="0.8" FontSize="11"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </StackPanel>
        </Border>

        <!-- çŽ©å®¶åˆ—è¡¨ -->
        <Border Grid.Row="2" Style="{StaticResource CardStyle}" Margin="0,8,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="ðŸ“‹ çŽ©å®¶åˆ—è¡¨" FontSize="16" FontWeight="Bold"
                           Margin="0,0,0,12"/>

                <DataGrid Grid.Row="1" x:Name="PlayersDataGrid"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          SelectionMode="Extended"
                          GridLinesVisibility="None"
                          HeadersVisibility="Column"
                          CanUserSortColumns="True">

                    <DataGrid.Columns>
                        <DataGridCheckBoxColumn Width="40" Binding="{Binding IsSelected}"/>

                        <DataGridTextColumn Header="è´¦å·ID" Binding="{Binding AccountId}" Width="80"/>
                        <DataGridTextColumn Header="è´¦å·å" Binding="{Binding Username}" Width="120"/>
                        <DataGridTextColumn Header="è§’è‰²å" Binding="{Binding CharacterName}" Width="120"/>
                        <DataGridTextColumn Header="ç­‰çº§" Binding="{Binding Level}" Width="60"/>

                        <DataGridTemplateColumn Header="çŠ¶æ€" Width="80">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding StatusColor}" CornerRadius="4"
                                            Padding="6,2">
                                        <TextBlock Text="{Binding Status}" Foreground="White"
                                                   FontSize="11" TextAlignment="Center"/>
                                    </Border>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="ç‚¹åˆ¸" Binding="{Binding Points}" Width="80"/>
                        <DataGridTextColumn Header="æœ€åŽç™»å½•" Binding="{Binding LastLogin}" Width="140"/>
                        <DataGridTextColumn Header="æ³¨å†Œæ—¶é—´" Binding="{Binding RegisterTime}" Width="140"/>
                        <DataGridTextColumn Header="IPåœ°å€" Binding="{Binding IpAddress}" Width="120"/>

                        <DataGridTemplateColumn Header="æ“ä½œ" Width="300">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <Button Content="è¯¦æƒ…" Click="ViewDetails_Click"
                                                Padding="8,4" FontSize="11"/>
                                        <Button Content="ðŸ”¨è¸¢å‡º" Click="KickPlayer_Click"
                                                Padding="8,4" FontSize="11"/>
                                        <Button Content="ðŸš«å°ç¦" Click="BanPlayer_Click"
                                                Padding="8,4" FontSize="11" Background="#F44336"
                                                Foreground="White"/>
                                        <Button Content="ðŸŽé“å…·" Click="SendItem_Click"
                                                Padding="8,4" FontSize="11"/>
                                        <Button Content="ðŸ’°ç‚¹åˆ¸" Click="SendPoints_Click"
                                                Padding="8,4" FontSize="11"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</Page>
