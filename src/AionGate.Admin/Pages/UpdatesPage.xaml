<Page x:Class="AionGate.Admin.Pages.UpdatesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.modernwpf.com/2019"
      Title="çƒ­æ›´æ–°ç®¡ç†">

    <Page.Resources>
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundAltHighBrush}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- é¡µé¢æ ‡é¢˜ -->
        <TextBlock Grid.Row="0" Text="çƒ­æ›´æ–°ç®¡ç†" FontSize="28" FontWeight="Bold" Margin="0,0,0,20"/>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <UniformGrid Grid.Row="1" Rows="1" Columns="4" Margin="0,0,0,20">
            <!-- æœ€æ–°ç‰ˆæœ¬ -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="ðŸŽ¯" FontSize="32" Margin="0,0,0,8"/>
                    <TextBlock Text="æœ€æ–°ç‰ˆæœ¬" FontSize="14" Opacity="0.7" Margin="0,0,0,4"/>
                    <TextBlock x:Name="TxtLatestVersion" Text="2.7.0.15" FontSize="24" FontWeight="Bold"/>
                    <TextBlock x:Name="TxtVersionFiles" Text="12,345 ä¸ªæ–‡ä»¶" FontSize="12" Opacity="0.6" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>

            <!-- ä»Šæ—¥æ›´æ–° -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="ðŸ“¥" FontSize="32" Margin="0,0,0,8"/>
                    <TextBlock Text="ä»Šæ—¥æ›´æ–°" FontSize="14" Opacity="0.7" Margin="0,0,0,4"/>
                    <TextBlock x:Name="TxtTodayUpdates" Text="0" FontSize="32" FontWeight="Bold"/>
                    <TextBlock x:Name="TxtUpdateSuccess" Text="æˆåŠŸçŽ‡: 0%" FontSize="12" Opacity="0.6" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>

            <!-- CDNæµé‡ -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="ðŸŒ" FontSize="32" Margin="0,0,0,8"/>
                    <TextBlock Text="ä»Šæ—¥CDNæµé‡" FontSize="14" Opacity="0.7" Margin="0,0,0,4"/>
                    <TextBlock x:Name="TxtCdnTraffic" Text="0 GB" FontSize="32" FontWeight="Bold" Foreground="#2196F3"/>
                    <TextBlock x:Name="TxtP2PTraffic" Text="P2Påˆ†æµ: 0%" FontSize="12" Opacity="0.6" Margin="0,4,0,0"/>
                </StackPanel>
            </Border>

            <!-- å¹³å‡é€Ÿåº¦ -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <TextBlock Text="âš¡" FontSize="32" Margin="0,0,0,8"/>
                    <TextBlock Text="å¹³å‡é€Ÿåº¦" FontSize="14" Opacity="0.7" Margin="0,0,0,4"/>
                    <TextBlock x:Name="TxtAvgSpeed" Text="0 MB/s" FontSize="32" FontWeight="Bold" Foreground="#4CAF50"/>
                </StackPanel>
            </Border>
        </UniformGrid>

        <!-- ä¸»å†…å®¹åŒº -->
        <ui:TabControl Grid.Row="2">
            <!-- ç‰ˆæœ¬ç®¡ç† -->
            <ui:TabItem Header="ç‰ˆæœ¬ç®¡ç†">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- å·¥å…·æ  -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                                <ComboBox x:Name="CmbVersionType" Width="150">
                                    <ComboBoxItem Content="å…¨éƒ¨ç±»åž‹" IsSelected="True"/>
                                    <ComboBoxItem Content="å®Œæ•´åŒ…"/>
                                    <ComboBoxItem Content="å¢žé‡åŒ…"/>
                                    <ComboBoxItem Content="è¡¥ä¸åŒ…"/>
                                </ComboBox>
                                <ComboBox x:Name="CmbVersionStatus" Width="150">
                                    <ComboBoxItem Content="å…¨éƒ¨çŠ¶æ€" IsSelected="True"/>
                                    <ComboBoxItem Content="å·²å‘å¸ƒ"/>
                                    <ComboBoxItem Content="æœªå‘å¸ƒ"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- æ“ä½œæŒ‰é’® -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                                <Button Content="ðŸ“ æ‰«ææ¸¸æˆç›®å½•" Style="{StaticResource AccentButtonStyle}" Click="ScanGameDirectory_Click"/>
                                <Button Content="âž• åˆ›å»ºç‰ˆæœ¬" Click="CreateVersion_Click"/>
                                <Button Content="ðŸ”„ åˆ·æ–°" Click="RefreshVersions_Click"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- ç‰ˆæœ¬åˆ—è¡¨ -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <DataGrid x:Name="VersionsDataGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  SelectionMode="Single"
                                  GridLinesVisibility="Horizontal"
                                  AlternatingRowBackground="#F5F5F5">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ç‰ˆæœ¬å·" Binding="{Binding VersionCode}" Width="120"/>
                                <DataGridTextColumn Header="ç‰ˆæœ¬åç§°" Binding="{Binding VersionName}" Width="150"/>
                                <DataGridTextColumn Header="ç±»åž‹" Binding="{Binding VersionTypeText}" Width="80"/>
                                <DataGridTextColumn Header="æ–‡ä»¶æ•°" Binding="{Binding FileCount}" Width="80"/>
                                <DataGridTextColumn Header="æ€»å¤§å°" Binding="{Binding TotalSizeText}" Width="100"/>
                                <DataGridTextColumn Header="CDN" Binding="{Binding CdnProvider}" Width="100"/>
                                <DataGridTextColumn Header="çŠ¶æ€" Binding="{Binding StatusText}" Width="80"/>
                                <DataGridTextColumn Header="åˆ›å»ºæ—¶é—´" Binding="{Binding CreatedAt, StringFormat=yyyy-MM-dd HH:mm}" Width="140"/>
                                <DataGridTemplateColumn Header="æ“ä½œ" Width="250">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <Button Content="ðŸ“‹" ToolTip="æŸ¥çœ‹æ¸…å•" Width="32" Click="ViewManifest_Click"/>
                                                <Button Content="ðŸ”—" ToolTip="ç”ŸæˆURL" Width="32" Click="GenerateUrls_Click"/>
                                                <Button Content="ðŸ“¤" ToolTip="ä¸Šä¼ CDN" Width="32" Click="UploadToCdn_Click"/>
                                                <Button Content="âœ…" ToolTip="å‘å¸ƒ" Width="32" Click="PublishVersion_Click"/>
                                                <Button Content="ðŸ“Š" ToolTip="ç»Ÿè®¡" Width="32" Click="ViewVersionStats_Click"/>
                                                <Button Content="ðŸ—‘ï¸" ToolTip="åˆ é™¤" Width="32" Click="DeleteVersion_Click"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </ui:TabItem>

            <!-- å¢žé‡æ›´æ–° -->
            <ui:TabItem Header="å¢žé‡æ›´æ–°">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- å·¥å…·æ  -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="ä»Žç‰ˆæœ¬:" VerticalAlignment="Center" FontWeight="Bold"/>
                            <ComboBox x:Name="CmbFromVersion" Width="150" DisplayMemberPath="VersionCode"/>
                            <TextBlock Text="â†’" VerticalAlignment="Center" FontSize="20" FontWeight="Bold"/>
                            <TextBlock Text="åˆ°ç‰ˆæœ¬:" VerticalAlignment="Center" FontWeight="Bold"/>
                            <ComboBox x:Name="CmbToVersion" Width="150" DisplayMemberPath="VersionCode"/>
                            <Button Content="ðŸ” è®¡ç®—å·®å¼‚" Style="{StaticResource AccentButtonStyle}" Click="CalculateDiff_Click"/>
                            <Button Content="ðŸ“¦ ç”Ÿæˆå¢žé‡åŒ…" Click="GenerateDiffPackage_Click"/>
                        </StackPanel>
                    </Border>

                    <!-- å·®å¼‚åˆ—è¡¨ -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- å·®å¼‚ç»Ÿè®¡ -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="20" Margin="0,0,0,16">
                                <Border Background="#4CAF50" CornerRadius="4" Padding="12,8">
                                    <StackPanel>
                                        <TextBlock Text="æ–°å¢žæ–‡ä»¶" Foreground="White" FontSize="12" Opacity="0.8"/>
                                        <TextBlock x:Name="TxtNewFiles" Text="0" Foreground="White" FontSize="24" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="#FF9800" CornerRadius="4" Padding="12,8">
                                    <StackPanel>
                                        <TextBlock Text="ä¿®æ”¹æ–‡ä»¶" Foreground="White" FontSize="12" Opacity="0.8"/>
                                        <TextBlock x:Name="TxtModifiedFiles" Text="0" Foreground="White" FontSize="24" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="#F44336" CornerRadius="4" Padding="12,8">
                                    <StackPanel>
                                        <TextBlock Text="åˆ é™¤æ–‡ä»¶" Foreground="White" FontSize="12" Opacity="0.8"/>
                                        <TextBlock x:Name="TxtDeletedFiles" Text="0" Foreground="White" FontSize="24" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="#2196F3" CornerRadius="4" Padding="12,8">
                                    <StackPanel>
                                        <TextBlock Text="ä¸‹è½½å¤§å°" Foreground="White" FontSize="12" Opacity="0.8"/>
                                        <TextBlock x:Name="TxtDiffSize" Text="0 MB" Foreground="White" FontSize="24" FontWeight="Bold"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- å·®å¼‚æ–‡ä»¶åˆ—è¡¨ -->
                            <DataGrid Grid.Row="1" x:Name="DiffFilesDataGrid"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      IsReadOnly="True"
                                      GridLinesVisibility="Horizontal">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="æ–‡ä»¶è·¯å¾„" Binding="{Binding FilePath}" Width="400"/>
                                    <DataGridTextColumn Header="æ“ä½œ" Binding="{Binding DiffTypeText}" Width="80"/>
                                    <DataGridTextColumn Header="å¤§å°" Binding="{Binding FileSizeText}" Width="100"/>
                                    <DataGridTextColumn Header="æ—§Hash" Binding="{Binding OldHash}" Width="150"/>
                                    <DataGridTextColumn Header="æ–°Hash" Binding="{Binding NewHash}" Width="150"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </Border>
                </Grid>
            </ui:TabItem>

            <!-- CDNç®¡ç† -->
            <ui:TabItem Header="CDNé…ç½®">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- å·¥å…·æ  -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <Button Content="âž• æ·»åŠ CDNèŠ‚ç‚¹" Style="{StaticResource AccentButtonStyle}" Click="AddCdnNode_Click"/>
                            <Button Content="ðŸ”„ åˆ·æ–°" Click="RefreshCdnNodes_Click"/>
                            <Button Content="ðŸ§ª æµ‹è¯•è¿žæŽ¥" Click="TestCdnConnection_Click"/>
                        </StackPanel>
                    </Border>

                    <!-- CDNèŠ‚ç‚¹åˆ—è¡¨ -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <DataGrid x:Name="CdnNodesDataGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  GridLinesVisibility="Horizontal"
                                  AlternatingRowBackground="#F5F5F5">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="èŠ‚ç‚¹åç§°" Binding="{Binding NodeName}" Width="150"/>
                                <DataGridTextColumn Header="æä¾›å•†" Binding="{Binding Provider}" Width="100"/>
                                <DataGridTextColumn Header="åŒºåŸŸ" Binding="{Binding Region}" Width="100"/>
                                <DataGridTextColumn Header="CDNåŸŸå" Binding="{Binding CdnDomain}" Width="200"/>
                                <DataGridTextColumn Header="ä¼˜å…ˆçº§" Binding="{Binding Priority}" Width="80"/>
                                <DataGridTextColumn Header="å·²ç”¨å­˜å‚¨" Binding="{Binding StorageUsedText}" Width="100"/>
                                <DataGridTextColumn Header="çŠ¶æ€" Binding="{Binding StatusText}" Width="80"/>
                                <DataGridTemplateColumn Header="æ“ä½œ" Width="150">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                <Button Content="âœï¸" ToolTip="ç¼–è¾‘" Width="32" Click="EditCdnNode_Click"/>
                                                <Button Content="ðŸ”Œ" ToolTip="å¯ç”¨/ç¦ç”¨" Width="32" Click="ToggleCdnNode_Click"/>
                                                <Button Content="ðŸ“Š" ToolTip="ç»Ÿè®¡" Width="32" Click="ViewCdnStats_Click"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </ui:TabItem>

            <!-- æ›´æ–°æ—¥å¿— -->
            <ui:TabItem Header="æ›´æ–°æ—¥å¿—">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- ç­›é€‰ -->
                    <Border Grid.Row="0" Style="{StaticResource CardStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <DatePicker Width="150"/>
                            <TextBlock Text="è‡³" VerticalAlignment="Center"/>
                            <DatePicker Width="150"/>
                            <ComboBox Width="120">
                                <ComboBoxItem Content="å…¨éƒ¨çŠ¶æ€" IsSelected="True"/>
                                <ComboBoxItem Content="æˆåŠŸ"/>
                                <ComboBoxItem Content="å¤±è´¥"/>
                                <ComboBoxItem Content="è¿›è¡Œä¸­"/>
                            </ComboBox>
                            <Button Content="ðŸ” æŸ¥è¯¢" Style="{StaticResource AccentButtonStyle}"/>
                            <Button Content="ðŸ“¥ å¯¼å‡º" Click="ExportUpdateLogs_Click"/>
                        </StackPanel>
                    </Border>

                    <!-- æ—¥å¿—åˆ—è¡¨ -->
                    <Border Grid.Row="1" Style="{StaticResource CardStyle}">
                        <DataGrid x:Name="UpdateLogsDataGrid"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  GridLinesVisibility="Horizontal"
                                  AlternatingRowBackground="#F5F5F5">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="è´¦å·ID" Binding="{Binding AccountId}" Width="100"/>
                                <DataGridTextColumn Header="æ¸ é“" Binding="{Binding ChannelCode}" Width="100"/>
                                <DataGridTextColumn Header="ä»Žç‰ˆæœ¬" Binding="{Binding FromVersion}" Width="100"/>
                                <DataGridTextColumn Header="åˆ°ç‰ˆæœ¬" Binding="{Binding ToVersion}" Width="100"/>
                                <DataGridTextColumn Header="æ›´æ–°ç±»åž‹" Binding="{Binding UpdateTypeText}" Width="100"/>
                                <DataGridTextColumn Header="è¿›åº¦" Binding="{Binding ProgressText}" Width="120"/>
                                <DataGridTextColumn Header="é€Ÿåº¦" Binding="{Binding DownloadSpeed, StringFormat={}{0:F2} MB/s}" Width="100"/>
                                <DataGridTextColumn Header="P2PçŽ‡" Binding="{Binding P2PRatio, StringFormat=P0}" Width="80"/>
                                <DataGridTextColumn Header="çŠ¶æ€" Binding="{Binding StatusText}" Width="80"/>
                                <DataGridTextColumn Header="å¼€å§‹æ—¶é—´" Binding="{Binding StartedAt, StringFormat=yyyy-MM-dd HH:mm}" Width="140"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>
                </Grid>
            </ui:TabItem>

            <!-- æ•°æ®ç»Ÿè®¡ -->
            <ui:TabItem Header="æ•°æ®ç»Ÿè®¡">
                <ScrollViewer>
                    <StackPanel Margin="16">
                        <!-- ä»Šæ—¥ç»Ÿè®¡ -->
                        <Border Style="{StaticResource CardStyle}">
                            <StackPanel>
                                <TextBlock Text="ä»Šæ—¥æ›´æ–°ç»Ÿè®¡" FontSize="20" FontWeight="Bold" Margin="0,0,0,16"/>
                                <UniformGrid Rows="1" Columns="5">
                                    <StackPanel Margin="0,0,20,0">
                                        <TextBlock Text="æ›´æ–°æ¬¡æ•°" FontSize="12" Opacity="0.7"/>
                                        <TextBlock x:Name="TxtStatsUpdateCount" Text="0" FontSize="28" FontWeight="Bold"/>
                                    </StackPanel>
                                    <StackPanel Margin="0,0,20,0">
                                        <TextBlock Text="æˆåŠŸçŽ‡" FontSize="12" Opacity="0.7"/>
                                        <TextBlock x:Name="TxtStatsSuccessRate" Text="0%" FontSize="28" FontWeight="Bold" Foreground="#4CAF50"/>
                                    </StackPanel>
                                    <StackPanel Margin="0,0,20,0">
                                        <TextBlock Text="æ€»ä¸‹è½½é‡" FontSize="12" Opacity="0.7"/>
                                        <TextBlock x:Name="TxtStatsTotalDownloaded" Text="0 GB" FontSize="28" FontWeight="Bold" Foreground="#2196F3"/>
                                    </StackPanel>
                                    <StackPanel Margin="0,0,20,0">
                                        <TextBlock Text="å¹³å‡é€Ÿåº¦" FontSize="12" Opacity="0.7"/>
                                        <TextBlock x:Name="TxtStatsAvgSpeed" Text="0 MB/s" FontSize="28" FontWeight="Bold"/>
                                    </StackPanel>
                                    <StackPanel>
                                        <TextBlock Text="å¹³å‡è€—æ—¶" FontSize="12" Opacity="0.7"/>
                                        <TextBlock x:Name="TxtStatsAvgTime" Text="0åˆ†é’Ÿ" FontSize="28" FontWeight="Bold"/>
                                    </StackPanel>
                                </UniformGrid>
                            </StackPanel>
                        </Border>

                        <!-- è¶‹åŠ¿å›¾è¡¨ -->
                        <Border Style="{StaticResource CardStyle}">
                            <StackPanel>
                                <TextBlock Text="æ›´æ–°è¶‹åŠ¿" FontSize="20" FontWeight="Bold" Margin="0,0,0,16"/>
                                <TextBlock Text="å›¾è¡¨åŒºåŸŸ - ä½¿ç”¨ LiveCharts æ˜¾ç¤ºè¶‹åŠ¿" Height="300" VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0.5"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </ui:TabItem>
        </ui:TabControl>
    </Grid>
</Page>
